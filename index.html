<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üì¶ Painel Administrativo ‚Ä¢ Mercatto Delivery</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0f19;--card:#151d2f;--text:#f8fafc;--muted:#94a3b8;
  --accent:#ffb347;--accent2:#ff8f1f;--ok:#22c55e;--warn:#eab308;--err:#ef4444;
  --radius:14px;--shadow:0 6px 20px rgba(0,0,0,.3);
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:'Inter',sans-serif;overflow-x:hidden;
}
header{
  background:linear-gradient(90deg,var(--accent2),var(--accent));
  text-align:center;padding:20px 10px;font-size:22px;
  font-family:'Playfair Display',serif;box-shadow:var(--shadow);
}
.container{max-width:1100px;margin:20px auto;padding:0 15px;}
.table{
  width:100%;border-collapse:collapse;background:var(--card);
  border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);
}
th,td{padding:10px 12px;text-align:left;font-size:14px;}
th{background:#1e293b;text-transform:uppercase;font-size:13px;}
tr:nth-child(even){background:#101827;}
.status{
  padding:4px 8px;border-radius:8px;font-weight:600;text-transform:capitalize;
}
.status.PENDENTE{background:#4338ca;color:#fff;}
.status.APROVADO{background:var(--ok);color:#fff;}
.status["SAIU PARA ENTREGA"]{background:var(--warn);color:#000;}
.status.CONCLU√çDO{background:#047857;color:#fff;}
button{
  padding:6px 12px;border:none;border-radius:8px;font-weight:600;
  cursor:pointer;transition:.2s;
}
.btnAprovar{background:var(--ok);color:#fff;}
.btnEntrega{background:var(--warn);color:#000;}
.btnConcluir{background:#047857;color:#fff;}
.btnExcluir{background:var(--err);color:#fff;}
button:hover{opacity:.85;}
#overlay{
  position:fixed;inset:0;display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,0.7);color:#fff;font-size:18px;z-index:9999;
}
</style>
</head>
<body>
<header>üì¶ Painel de Pedidos - Mercatto Delivery</header>
<div class="container">
  <table class="table" id="tabela">
    <thead>
      <tr>
        <th>Data/Hora</th><th>Nome</th><th>Itens</th><th>Total</th>
        <th>Status</th><th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="listaPedidos"></tbody>
  </table>
</div>

<div id="overlay">Atualizando status...</div>

<script>
const ENDPOINT = "https://script.google.com/macros/s/AKfycbxcdhUN2YY-iSejxsxc7AWAG4t_DYKN7_tJkNrZ4O1acG5v0Wr0zUDMga2b2FiOs6Qa/exec";

/* üîÑ CARREGAR PEDIDOS */
async function carregarPedidos(){
  const res = await fetch(`${ENDPOINT}?acao=listaPedidos`);
  const pedidos = await res.json();
  const corpo = document.getElementById("listaPedidos");
  corpo.innerHTML = "";

  pedidos.reverse().forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p["Data/Hora"]||""}</td>
      <td>${p["Nome"]||""}</td>
      <td>${p["Itens"]||""}</td>
      <td><strong>R$${Number(p["Total (R$)"]||0).toFixed(2)}</strong></td>
      <td><span class="status ${p.Status}">${p.Status}</span></td>
      <td>
        <button class="btnAprovar" onclick="mudarStatus('${p['C√≥digo Interno (ID Pedido)']}','APROVADO')">Aprovar</button>
        <button class="btnEntrega" onclick="mudarStatus('${p['C√≥digo Interno (ID Pedido)']}','SAIU PARA ENTREGA')">Entrega</button>
        <button class="btnConcluir" onclick="mudarStatus('${p['C√≥digo Interno (ID Pedido)']}','CONCLU√çDO')">Concluir</button>
      </td>`;
    corpo.appendChild(tr);
  });
}

/* üîÅ ALTERAR STATUS */
async function mudarStatus(id, status){
  document.getElementById("overlay").style.display="flex";
  try{
    const r = await fetch(`${ENDPOINT}?acao=atualizaStatus&id=${id}&status=${encodeURIComponent(status)}`);
    const t = await r.text();
    if(t.includes("ok")){
      await carregarPedidos();
    }else{
      alert("Erro ao atualizar status!");
    }
  }catch(err){
    alert("Erro de conex√£o: "+err);
  }finally{
    document.getElementById("overlay").style.display="none";
  }
}

window.onload=carregarPedidos;
</script>
</body>
</html>
